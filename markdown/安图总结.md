[TOC]



#  安图功能（IP过滤和域名过滤同时使用）总结

## 1 四表五链简单回顾

- iptables 

防火墙的管理工具，为数据包的过滤提供规则。

- 四表五链

>四表：
>
>raw: 修改nat表的追踪机制，是否对数据包进行追踪
>
>mangle: 报文拆解、修改、封装
>
>nat: IP地址转换
>
>filter: 过滤功能
>
>五链：
>
>input 目的地址为本机，在防火墙本机接收到数据包时使用
>
>output 源地址为本机，向外发送，防火墙发送数据包
>
>forward 分组转发时使用
>
>prerouting 数据包进入路由之前使用
>
>postrouting 发送到网卡之前，做出路由选择之后使用

- 数据包通过四个表的顺序

  raw–>mangle–>nat–>filter

- filter表包含3条链

  INPUR、OUTPUT、FORWARD

- 数据包流向

  ![image-20221021100107367](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20221021100107367.png)数据包在

  filter表中经过的链：

  ![image-20221021100128033](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20221021100128033.png)

  ​	根据路由器的功能，主要处理的是INPUT链和FARWARD链。
  
  

##  2 查看相关文件

设置ip过滤白名单、域名过滤白名单，放行IP地址8.8.8.8和域名www.baidu.com

![image-20221021105858263](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20221021105858263.png)

![image-20221021105841222](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20221021105841222.png)

- 查看cli.conf文件

![image-20221021104044264](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20221021104044264.png)

![image-20221021104108392](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20221021104108392.png)

开启白名单后，出现以上字样。

- 查看filter表

![image-20221021103746893](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20221021103746893.png)

**FORWARD链的默认规则变为DROP，域名转换成IP地址写到forwar_ip_list链中。**

##  3 关键代码

见图片







